<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>烬王的技术博客</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://es-7.github.io/"/>
  <updated>2017-12-23T10:53:57.000Z</updated>
  <id>https://es-7.github.io/</id>
  
  <author>
    <name>烬王</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>为何前端要使用框架？</title>
    <link href="https://es-7.github.io/2015/08/02/whyUseFrame/"/>
    <id>https://es-7.github.io/2015/08/02/whyUseFrame/</id>
    <published>2015-08-01T16:00:00.000Z</published>
    <updated>2017-12-23T10:53:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>亲爱的各位观众看官好～最近在团队里组织了一次内容关于React的分享，然而后端有同学反映未能理解为何前端需要使用框架，框架究竟解决了什么问题。<br><a id="more"></a><br>回想刚入坑前端的时候，也接触了一些Java，当了解到其实Java可以生成HTML模板之后，对前端的信仰几乎崩溃。既然后端就可以渲染前端的话，前端价值到底在哪？感觉页面就是随便切一下就行，根本没必要用框架，当时着实迷茫了很久。</p><p>后来对前端领域接触深了，再经过大神的指点，总算是理解为何前端需要使用框架。根据自己的理解，再结合分享时后端同学的疑问，于是有了这篇文章。本文相对小白向，只是通过虚拟一个项目说明问题，还望各位大神不吝赐教。</p><h2 id="开始新项目"><a href="#开始新项目" class="headerlink" title="开始新项目"></a>开始新项目</h2><blockquote><p>产品： 来来来，新项目来啦。最近发现用户喜欢撸猫，我们来个在线云撸猫！页面要求有猫图，点一下计数加一点当撸了一次！多久能上线？？<br>这个简单啊！</p></blockquote><p><img src="/blog/2015/08/02/whyUseFrame/1.png" alt="狂暴姿态"></p><p>厉害的我连jQuery都不用，原生上！</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"1.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>0<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> img = <span class="built_in">document</span>.querySelector(<span class="string">'img'</span>); </span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> p = <span class="built_in">document</span>.querySelector(<span class="string">'p'</span>); </span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> count = <span class="number">0</span>; </span></span><br><span class="line"><span class="javascript">        img.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; </span></span><br><span class="line"><span class="undefined">               count += 1; </span></span><br><span class="line"><span class="undefined">               p.innerHTML = count; </span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p>简单易懂，对不对！</p><h2 id="需求变更"><a href="#需求变更" class="headerlink" title="需求变更"></a>需求变更</h2><blockquote><p>产品： 线上大受欢迎，然而要改需求了爸爸！现在要两只喵，点击要分开算哦，各自显示就好。你最棒了，我知道你肯定可以的！</p></blockquote><p>看在叫了爸爸的份上，还是给他改一下吧。然而第一个版本多粗糙啊，各种污染全局变量，第二版我要写得棒棒的！</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"catSection"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"cat1.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"catImg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"catCount"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"catSection"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"cat2.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"catImg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"catCount"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> catSection = <span class="built_in">document</span>.querySelectorAll(<span class="string">'.catSection'</span>);</span></span><br><span class="line"><span class="javascript">        catSection.forEach(<span class="function">(<span class="params">section</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> count = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> catImg = section.querySelector(<span class="string">'.catImg'</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">const</span> catCount = section.querySelector(<span class="string">'.catCount'</span>);</span></span><br><span class="line"><span class="javascript">            catImg.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span></span><br><span class="line"><span class="undefined">                count++;</span></span><br><span class="line"><span class="undefined">                catCount.innerHTML = count;</span></span><br><span class="line"><span class="undefined">            &#125;)</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined">    &#125;)()</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>没有污染全局变量，还可以扩展需求，后续产品就算要求再多的猫我都能hold住！</p><p> <img src="/blog/2015/08/02/whyUseFrame/2.png" alt="6不6"></p><h2 id="再一次需求变更"><a href="#再一次需求变更" class="headerlink" title="再一次需求变更"></a>再一次需求变更</h2><blockquote><p>产品： 父皇，你听我说啊，就最后一次，真的最后一次。现在猫两只不够啊，但太多的话展示又不好看。现在需求做一个列表，列表有N只猫，点那只猫展示那只猫，每次只展示意志，而且猫要有对应的名字哦，点击也要分开统计！其实跟以前差不多？就改改就好了。明天就要哦！</p></blockquote><p> <img src="/blog/2015/08/02/whyUseFrame/3.png" alt="草泥马"></p><p> 然而，吐槽归吐槽，需求还是要做的。而且需求明天就要，代码写得再好也可能马上改功能，代码还是实现功能就算了吧。<br> 具体代码由各位看官自己实现（建议先停下来，动手去实现这个需求），这里我就不再上代码了。很可能我们这次写的代码，就不会太考虑什么全局变量污染，也不考虑封装的问题，逐渐趋向于实现功能就好了，因为需求太多了，时间和精力限制了去写“好”代码。<br> 当然了，产品经理说需求最后一次改，都是骗人的。下次可能会有点击到某个值时，自动切换猫，动态添加猫等等的新需求。我们现在这样组织代码的形式，是典型的”意大利面式“代码（简单说，就是各种东西整合在一起，层级不分，难以维护）。这种代码写起来直观，但日后的维护是相当难的。写出上述例子后，不妨隔两天再去看看能否轻易理解那一份代码。自己写的代码尚且如此，他人的更不在话下了。<br> 那么，这种随着项目越来越复杂，逻辑越来越多，我们该怎么写代码呢？</p><h2 id="更好地组织代码"><a href="#更好地组织代码" class="headerlink" title="更好地组织代码"></a>更好地组织代码</h2><p>前端其实有一种说法：我们现在的”新“东西，都是其他领域玩过的。虽然看起来很气人，但这也是事实。当现状不知如何处理时，不妨参考下其他领域的解决方案。离前端比较近的就是后端了，那么后端是怎么管理的呢？最典型的设计就是MVC了。那么，前端能不能借鉴呢？<br>说干就干，以上面的需求为例，我们试着用MVC的方式组织一下代码，看下和你刚才写的有什么不同。<br>先来M，也就是Model，数据层，对外提供接口可以获取相关的数据。这么组织的话，是不是蛮好懂的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> model = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//相关数据</span></span><br><span class="line">  <span class="keyword">const</span> _model = &#123;</span><br><span class="line">    catLists: [</span><br><span class="line">      &#123;</span><br><span class="line">        src: <span class="string">'1.jpg'</span>,</span><br><span class="line">        name: <span class="string">'cat1'</span>,</span><br><span class="line">        count: <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        src: <span class="string">'2.jpg'</span>,</span><br><span class="line">        name: <span class="string">'cat2'</span>,</span><br><span class="line">        count: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    targetCatIndex: <span class="number">0</span>, <span class="comment">//目前可被点击的是哪知喵在catLists中的索引</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取getCatLists</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getCatLists</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _model.catLists;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取目标对象</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getTargetCatObj</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _model.catLists[_model.targetCatIndex];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//修改targetCatIndex</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">setTargetCatIndex</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    _model.catLists.some(<span class="function">(<span class="params">catObj, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (catObj.name === name) &#123;</span><br><span class="line">        _model.targetCatIndex = index;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//目标对象点击数+1</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">addTargetCatCount</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> catObj = getTargetCatObj();</span><br><span class="line">    catObj.count += <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    getCatLists,</span><br><span class="line">    getTargetCatObj,</span><br><span class="line">    setTargetCatIndex,</span><br><span class="line">    addTargetCatCount</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>在自执行函数中，设计了一个对象命名为_model，通过闭包存储它。自执行函数返回一个对象，其中包含四个函数。四个函数执行后，可以返回或修改_model中对应的数据。通过注释看其实还是挺清楚的。<br>跟着是V，也就是view层，负责页面渲染。这个可能复杂一点，但不想把它弄得太繁琐，不如就两个方法吧。就一个初始化的init()和负责更新视图的render()方法就好啦。</p><p>先确定HTML模板：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"catList"</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"clickArea"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">""</span> <span class="attr">class</span>=<span class="string">"catImage"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"catCount"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"catName"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>再组织一下view层的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> view = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取各个需要操作的DOM节点</span></span><br><span class="line">  <span class="keyword">const</span> img = <span class="built_in">document</span>.querySelector(<span class="string">'.catImage'</span>);</span><br><span class="line">  <span class="keyword">const</span> name = <span class="built_in">document</span>.querySelector(<span class="string">'.catName'</span>);</span><br><span class="line">  <span class="keyword">const</span> count = <span class="built_in">document</span>.querySelector(<span class="string">'.catCount'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//初始化页面</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params">catLists, targetObj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> list = <span class="built_in">document</span>.querySelector(<span class="string">'.catList'</span>);</span><br><span class="line">    <span class="keyword">const</span> fragment = <span class="built_in">document</span>.createDocumentFragment();</span><br><span class="line">    <span class="comment">//为ul添加对应的li</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = catLists.length; i &lt; len; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> li = <span class="built_in">document</span>.createElement(<span class="string">'li'</span>);</span><br><span class="line">      <span class="keyword">const</span> name = catLists[i].name;</span><br><span class="line">      li.innerHTML = name;</span><br><span class="line">      li.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//之后会有controller相关的代码，其实就是换一只可点击的喵</span></span><br><span class="line">        controller.changeTargetCat(name);</span><br><span class="line">      &#125;);</span><br><span class="line">      fragment.appendChild(li);</span><br><span class="line">    &#125;</span><br><span class="line">    list.appendChild(fragment);</span><br><span class="line">    img.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">//之后会有controller相关的代码，其实就是计数+1</span></span><br><span class="line">      controller.addCount(name);</span><br><span class="line">    &#125;);</span><br><span class="line">    render(targetObj);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//重新渲染页面</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">targetObj</span>) </span>&#123;</span><br><span class="line">    img.src = targetObj.src;</span><br><span class="line">    name.innerHTML = targetObj.name;</span><br><span class="line">    count.innerHTML = targetObj.count;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    init,</span><br><span class="line">    render</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure><p>view层的代码其实也很简单的，和model层的套路差不多，通过自执行函数结合闭包存储之后要操作的节点，对外暴露由两个方法组成的对象，分别是init与render。init用于初始化话页面，render用于重新渲染页面。里面调用了controller，其实就是之后要介绍的controller。<br>最后是C层，也就是controller，主要是用于逻辑相关的处理，算是整个设计里面的大脑。不过由于这项目比较简单，所以代码反而是最简单的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> controller = &#123;</span><br><span class="line">  addCount(name) &#123;</span><br><span class="line">    <span class="comment">//通过model的接口增加目标对象的计数</span></span><br><span class="line">    model.addTargetCatCount(name);</span><br><span class="line">    controller.renderView();</span><br><span class="line">  &#125;,</span><br><span class="line">  changeTargetCat(name) &#123;</span><br><span class="line">    <span class="comment">//通过model的接口修改目标索引</span></span><br><span class="line">    model.setTargetCatIndex(name);</span><br><span class="line">    controller.renderView();</span><br><span class="line">  &#125;,</span><br><span class="line">  init() &#123;</span><br><span class="line">    <span class="comment">//通过model的接口获取相关数据</span></span><br><span class="line">    <span class="keyword">const</span> &#123; getCatLists, getTargetCatObj &#125; = model;</span><br><span class="line">    <span class="comment">//传参并命令view层初始化</span></span><br><span class="line">    view.init(getCatLists(), getTargetCatObj());</span><br><span class="line">  &#125;,</span><br><span class="line">  renderView() &#123;</span><br><span class="line">    <span class="comment">//传参并命令view层重新渲染</span></span><br><span class="line">    view.render(model.getTargetCatObj());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>controller的设计其实是比较简陋的，只是一个包含了四个方法的对象。其中addCount对应点击加一的操作，changeTargetCat对应换猫的操作。上述两个方法其实是改变了数据的，而只要数据发生了变化，一律调用renderView重新渲染。<br>至此主要代码已经写完了，之后调用一下controller.init();，就可以开心的撸猫，完成需求了。<br>如果之前你动手实现了上述需求的话，不妨对比一下我们设计代码上的差别。也许你写的代码还是之前那种“面条式”代码，但它也是可用的啊，而且还不用这么多代码呢，长得也还算能维护的样子，为何要用这种繁琐的方式去阻止代码呢？<br>然而，按照之前说的,产品可能提更多的需求，下次可能会有点击到某个值时，自动切换猫，动态添加猫等等的新需求时，你现在的代码组织形式能否很快地完成需求？当日后修改某些需求时，不小心触发了潜藏的bug（经常有的情况），又是否能快速定位出问题并快速改好呢？<br>“面条式”代码经常是数据、视图与处理逻辑耦合起来的，很容易牵一发而动全身，当业务相当复杂的时候，开发可能还好说，维护简直是不可想象的。而你可能已经观察到了，遵循MVC设计的代码，虽然繁琐，但各层是完全分开的，尽管数据与视图可以直接调用对方的接口进行交互，但都是必须通过控制层来做统一处理。数据、视图与处理逻辑解耦之后，代码的可阅读性与可维护性都是一个飞跃。通过牺牲空间（多写代码）来换取代码的可维护性与可拓展性，这是一笔划算的买卖。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>说了半天，好像还没有说出为何前端需要使用框架。然而在复杂的项目中，你同意我通过MVC组织代码会比“面条式”代码好吗？如果同意的话，将我刚才代码中不变的部分抽象起来（组件通讯、报错处理等），想方设法提高渲染的性能（使用Virtual Dom），如果认为前端和其他不一样，数据和视图还是可以进行受控的交互(即MVVM)，那么整合起来，不就是一个框架了吗？<br>其实必须要承认，人的脑力是有限的，一款产品的需求可能是无限的。当这款产品已经让你无法掌握每个细节，每位参与开发的同学只能掌握局部细节，而其他部分只管调用是必然的事实。但是，如何确定其他部分可信，调用不会出bug呢？这时候就该使用框架了。框架较大程度上能约束与规范每位开发者的行为，不按照框架的规定很可能就会报错，这样多人协作就有了基本的保证。<br>但是，不是说使用框架就是最佳实践。当项目不复杂的时候（比如一次性的活动页），我们有足够能力去掌握项目的细节，那么使用框架反而不是好的选择。毕竟再好的框架在性能上都会有损失，而被框架的条条框框约束着，也总是令人不喜的。<br>简单地说：脑子不够，框架来凑；自己组织不好代码，靠框架来给我们组织。阅读至此殊为不易，感谢各位看官，希望本文对你有一点帮助，谢谢！</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;亲爱的各位观众看官好～最近在团队里组织了一次内容关于React的分享，然而后端有同学反映未能理解为何前端需要使用框架，框架究竟解决了什么问题。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="web前端" scheme="https://es-7.github.io/categories/web%E5%89%8D%E7%AB%AF/"/>
    
      <category term="框架" scheme="https://es-7.github.io/categories/web%E5%89%8D%E7%AB%AF/%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="杂谈" scheme="https://es-7.github.io/tags/%E6%9D%82%E8%B0%88/"/>
    
  </entry>
  
  <entry>
    <title>实现前端模板引擎</title>
    <link href="https://es-7.github.io/2015/07/18/template/"/>
    <id>https://es-7.github.io/2015/07/18/template/</id>
    <published>2015-07-17T16:00:00.000Z</published>
    <updated>2017-12-23T10:53:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>   前端模板引擎相信大家都不会陌生了吧，尤其是注重前后端分离的今天(除非你还在用拼接字符串)。<br>   <strong>引擎</strong>一词总让人感觉很高端的样子，其实归根结底也只是处理字符串的一种方式而已。<br>   本文总结了3种实现模板引擎的方式，最后将逐步实现一个类似于 underscore.template 的模板插件。<br> <a id="more"></a>  </p><h3 id="一、replace模板"><a href="#一、replace模板" class="headerlink" title="一、replace模板"></a>一、replace模板</h3><p>replace 是字符串提供的一个超级强大的方法，这里举例介绍简单的使用。</p><ul><li>一参可为 <code>字符串</code> 或 <code>正则</code>:<br>  ○ 为正则时有两种情况: <code>普通匹配模式</code> 和 <code>全局匹配模式</code>:<br>  ■ 全局匹配模式下，若二参为函数，则该函数在每次匹配时都会被调用    </li><li>二参可为 <code>字符串</code> 或 <code>一个用于生成字符串的函数</code>:<br>  ○ 当为字符串时:<pre><code>■ 可在字符串中使用 特殊替换字符 ($n ...)</code></pre>  ○ 当为函数时:<pre><code>■ 函数中不能用特殊替换字符■ 一参为正则匹配的文本■ 倒数第二参为匹配到的子字符串在原字符串中的偏移量■ 最后一参为被匹配的原始字符串■ 其余参数为正则中每个分组匹配到的文本                  </code></pre></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replacer</span>(<span class="params">match, p1, p2, p3, offset, string</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// match 为 'abc12345#$*%'        : 正则匹配的文本</span></span><br><span class="line">  <span class="comment">// p1,p2,p3 分别为 abc 12345 #$*% : 即每个小组匹配到的文本, pn 表示有 n 个小组</span></span><br><span class="line">  <span class="comment">// offset 为 0 : 匹配到的子字符串在原字符串中的偏移量。</span></span><br><span class="line">  <span class="comment">// （比如，如果原字符串是'abcd'，匹配到的子字符串时'bc'，那么这个参数将是1）</span></span><br><span class="line">  <span class="comment">// string 为 'abc12345#$*%'       : 被匹配的原始字符串</span></span><br><span class="line">    <span class="keyword">return</span> [p1, p2, p3].join(<span class="string">' - '</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注意正则中的 括号 ，这里分有 3个组</span></span><br><span class="line"><span class="keyword">var</span> newString = <span class="string">'abc12345#$*%'</span>.replace(<span class="regexp">/([^\d]*)(\d*)([^\w]*)/</span>, replacer);</span><br><span class="line"><span class="comment">// newString =&gt; 'abc - 12345 - #$*%'</span></span><br></pre></td></tr></table></figure><p>再举几个简单的案例:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最基础的使用</span></span><br><span class="line"><span class="string">'123'</span>.replace(<span class="string">'1'</span>, <span class="string">'A'</span>) <span class="comment">// 'A23'</span></span><br><span class="line"><span class="string">'lalala 2Away0x2'</span>.replace(<span class="regexp">/2(.*)2/</span>, <span class="string">'$1'</span>) <span class="comment">// 'lalala Away0x'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// trim</span></span><br><span class="line"><span class="keyword">const</span> trim = <span class="function"><span class="params">str</span> =&gt;</span> str.replace(<span class="regexp">/(^\s*)|(\s*$)/g</span>, <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">trim(<span class="string">'  abc   '</span>) <span class="comment">// 'abc'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// format</span></span><br><span class="line"><span class="keyword">const</span> format = <span class="function"><span class="params">str</span> =&gt;</span></span><br><span class="line">    (...args) =&gt;</span><br><span class="line">        str.replace(<span class="regexp">/&#123;(\d+)&#125;/g</span>, (match, p) =&gt; args[p] || <span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">format(<span class="string">'lalal&#123;0&#125;wowowo&#123;1&#125;hahah&#123;2&#125;'</span>)(<span class="string">'-A-'</span>, <span class="string">'-B-'</span>, <span class="string">'-C'</span>) <span class="comment">// lala-A-wowo-B-haha-C</span></span><br></pre></td></tr></table></figure><h4 id="replace模板原理："><a href="#replace模板原理：" class="headerlink" title="replace模板原理："></a><strong>replace模板原理</strong>：</h4><p>先在模板中预留占位，再将对应的数据填入</p><h4 id="实现"><a href="#实现" class="headerlink" title="实现:"></a><strong>实现</strong>:</h4><p>目标1：可填充简单数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tpl = <span class="function">(<span class="params">str, data</span>) =&gt;</span> str.replace(<span class="regexp">/&#123;&#123;(.*)&#125;&#125;/g</span>, (match, p) =&gt; data[p])</span><br><span class="line">tpl(<span class="string">'&lt;div&gt;&#123;&#123;data&#125;&#125;&lt;/div&gt;'</span>, &#123;<span class="attr">data</span>: <span class="string">'tpl'</span>&#125;) <span class="comment">// '&lt;div&gt;tpl&lt;/div&gt;'</span></span><br></pre></td></tr></table></figure><p>目标2：可填充嵌套数据</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可根据占位符 &#123;&#123;data.a&#125;&#125; 中的 "." 来获得数据的依赖路径，从而得到对应的数据</span></span><br><span class="line"><span class="comment">// 由于 使用 "." 连接，所以其前后应为合法的变量名，因此需重新构造正则</span></span><br><span class="line"><span class="comment">/* 合法变量名</span></span><br><span class="line"><span class="comment">*    - 开头可为字符和少量特殊字符: [a-zA-Z$_]</span></span><br><span class="line"><span class="comment">*    - 余部还可是数字:            [a-zA-Z$_0-9]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 除开头外还需匹配 连接符 "." ,因此最终正则为: /&#123;&#123;([a-zA-Z$_][a-zA-Z$_0-9\.]*)&#125;&#125;/g</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tpl</span> (<span class="params">str, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> reg = <span class="regexp">/&#123;&#123;([a-zA-Z$_][a-zA-Z$_0-9\.]*)&#125;&#125;/g</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 全局匹配模式下，replace 的回调在每次匹配时都会执行,</span></span><br><span class="line">    <span class="comment">// p 为占位符中的变量,该例为 data.a</span></span><br><span class="line">    <span class="keyword">return</span> str.replace(reg, (match, p) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> paths = p.split(<span class="string">'.'</span>) <span class="comment">// ['data', 'a']</span></span><br><span class="line">        <span class="keyword">let</span> result  = data</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (paths.length &gt; <span class="number">0</span>)</span><br><span class="line">            result = result[ paths.shift() ] <span class="comment">// 得到路径最末端的数据</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">String</span>(result) || match <span class="comment">// 需转成字符串，因为可能遇到 0, null 等数据</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">tpl(<span class="string">'&lt;div&gt;&#123;&#123;data.a&#125;&#125;&lt;/div&gt;'</span>, &#123;<span class="attr">data</span>: &#123;<span class="attr">a</span>: <span class="string">'tpl'</span>&#125;&#125;) <span class="comment">// '&lt;div&gt;tpl&lt;/div&gt;'</span></span><br></pre></td></tr></table></figure><p><strong>最终代码</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tpl</span> (<span class="params">str, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> reg = <span class="regexp">/&#123;&#123;([a-zA-Z$_][a-zA-Z$_0-9\.]*)&#125;&#125;/g</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str.replace(reg, (match, p) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> paths = p.split(<span class="string">'.'</span>)</span><br><span class="line">        <span class="keyword">let</span> result  = data</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (paths.length &gt; <span class="number">0</span>)</span><br><span class="line">            result = result[ paths.shift() ]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">String</span>(result) || match</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>优缺点</strong>：</p><ul><li>优点：简单</li><li>缺点：模板不支持表达式（for/if/else等等），所有数据得先计算好再填入，灵活性差，难以满足复杂的需求。</li></ul><p><strong>资料</strong><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/String/replace" target="_blank" rel="noopener">replace详细语法</a></p><h3 id="二、es6模板字符串"><a href="#二、es6模板字符串" class="headerlink" title="二、es6模板字符串"></a>二、es6模板字符串</h3><p> 模板字符串是 es6 中我最爱的特性啦！比起传统模板引擎，我更喜欢用模板字符串来编写组件</p><ul><li>模板字符串包裹在 反引号(Esc按钮下面那个) 中，其中可通过 ${} 的语法进行插值</li></ul> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 特性一:多行</span></span><br><span class="line"><span class="string">`123123</span></span><br><span class="line"><span class="string"> 23213`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 特性二: 字符串中可插值（强大的不要不要的）</span></span><br><span class="line"><span class="comment">/* 作为一门伪函数式编程语言，js 的很多语法都可以返回数据:</span></span><br><span class="line"><span class="comment">*    - 表达式: 各种运算符表达式，三目(可用来替代简单的判断语句)</span></span><br><span class="line"><span class="comment">*    - 函数:  封装各种复杂的逻辑，最后返回一个值即可</span></span><br><span class="line"><span class="comment">*    - 方法:  如一些有返回值的数据方法</span></span><br><span class="line"><span class="comment">*       - 最强大的如数组的 map, filter ...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 以下字符串都等于 '123tpl456'</span></span><br><span class="line"><span class="keyword">const</span> str1 = <span class="string">`123<span class="subst">$&#123;<span class="string">'tpl'</span>&#125;</span>456`</span></span><br><span class="line"><span class="keyword">const</span> str2 = <span class="string">`123<span class="subst">$&#123;<span class="literal">false</span> || <span class="string">'tpl'</span>&#125;</span>456`</span></span><br><span class="line"><span class="keyword">const</span> str3 = <span class="string">`123<span class="subst">$&#123;<span class="literal">true</span> ? <span class="string">'tpl'</span> : <span class="string">''</span>&#125;</span>456`</span></span><br><span class="line"><span class="keyword">const</span> str4 = <span class="string">`123<span class="subst">$&#123; (<span class="keyword">function</span> () &#123;<span class="keyword">return</span> <span class="string">'tpl'</span>&#125;</span>()) &#125;456`</span></span><br><span class="line"><span class="keyword">const</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> <span class="string">'tpl'</span></span><br><span class="line"><span class="keyword">const</span> str5 = <span class="string">`123<span class="subst">$&#123; fn() &#125;</span>456`</span></span><br><span class="line"><span class="keyword">const</span> str6 = <span class="string">`123<span class="subst">$&#123;</span></span></span><br><span class="line"><span class="string"><span class="subst">    [<span class="string">'T'</span>, <span class="string">'P'</span>, <span class="string">'L'</span>].map(s =&gt; s.toLowerCase()).join(<span class="string">''</span>)</span></span></span><br><span class="line"><span class="string"><span class="subst">&#125;</span>456`</span></span><br><span class="line"><span class="built_in">console</span>.log([str1, str2, str3, str4, str5, str6].every(<span class="function"><span class="params">s</span> =&gt;</span> s === <span class="string">'123tpl456'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 特性三: 模板函数 (个人很少用到)</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">5</span>, b = <span class="number">10</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tag</span> (<span class="params">strArr, ...vals</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(strArr, vals)</span><br><span class="line">&#125;</span><br><span class="line">tag<span class="string">`Hello <span class="subst">$&#123; a + b &#125;</span> world <span class="subst">$&#123;a * b&#125;</span>`</span></span><br><span class="line"><span class="comment">// strArr =&gt; ['Hello ', ' world ', '']</span></span><br><span class="line"><span class="comment">// vals   =&gt; [15, 30]  ($&#123;&#125;里的值)</span></span><br></pre></td></tr></table></figure><p>下面用es6模板字符串写一个分页组件:</p><p></p><p data-height="265" data-theme-id="dark" data-slug-hash="XVKxyO" data-default-tab="result" data-user="jinwang" data-embed-version="2" data-pen-title="XVKxyO" class="codepen">See the Pen <a href="https://codepen.io/jinwang/pen/XVKxyO/" target="_blank" rel="noopener">XVKxyO</a> by  石其龙 (<a href="https://codepen.io/jinwang" target="_blank" rel="noopener">@jinwang</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><p><strong>资料</strong><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/template_strings" target="_blank" rel="noopener">es6模板字符串语法</a></p><h3 id="三、Function模板"><a href="#三、Function模板" class="headerlink" title="三、Function模板"></a>三、Function模板</h3><p>Function 是 js 提供的一个用于构造 Function 对象的构造函数</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 普通函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span> (<span class="params">user, msg</span>) </span>&#123;</span><br><span class="line">   <span class="built_in">console</span>.log(user, msg)</span><br><span class="line">&#125;</span><br><span class="line">log(<span class="string">'Away0x'</span>, <span class="string">'lalala'</span>)</span><br><span class="line"><span class="comment">// Function 构造函数</span></span><br><span class="line"><span class="keyword">const</span> log = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'user'</span>, <span class="string">'msg'</span>, <span class="string">'console.log(user, msg)'</span>)</span><br><span class="line">log(<span class="string">'Away0x'</span>, <span class="string">'lalala'</span>)</span><br></pre></td></tr></table></figure><p>大多数前端模板引擎都是用这种方式实现的，其原理在于运用了 js Function 对象可将字符串解析为函数的能力。<br>一个普通模板引擎的工作步骤大致如下:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 编写模板(本例子拟以&#123;# #&#125;为模板语法)</span></span><br><span class="line">&#123;# if( data.con &gt; 20 ) &#123; #&#125;</span><br><span class="line">    &lt;p&gt;ifififififif&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&#123;# &#125; else &#123; #&#125;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;elseelseelseelse&lt;/</span>p&gt;</span><br><span class="line">&#123;# &#125; #&#125;</span><br><span class="line"><span class="comment">// 2. 由模板生成函数体字符串</span></span><br><span class="line"><span class="keyword">const</span> functionbody = <span class="string">`</span></span><br><span class="line"><span class="string">    var tpl = ''</span></span><br><span class="line"><span class="string">    if (data.con &gt; 20) &#123;</span></span><br><span class="line"><span class="string">        tpl += '&lt;p&gt;ifififififif&lt;/p&gt;'</span></span><br><span class="line"><span class="string">    &#125; else &#123;</span></span><br><span class="line"><span class="string">        tpl += '&lt;p&gt;ifififififif&lt;/p&gt;'</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    return tpl</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="comment">// 3. 通过 Function 解析字符串并生成函数</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'data'</span>, functionbody)(data)</span><br></pre></td></tr></table></figure><p>由此可见，只要将模板识别码里的字符串内容生成 js语句，而其余内容之前加上 一个 ‘tpl += ‘ 即可。<br>实现代码如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tpl = <span class="function">(<span class="params">str, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> tplStr = str.replace(<span class="regexp">/\n/g</span>, <span class="string">''</span>)</span><br><span class="line">        .replace(<span class="regexp">/&#123;&#123;(.+?)&#125;&#125;/g</span>, (match, p) =&gt; <span class="string">`'+(<span class="subst">$&#123;p&#125;</span>)+'`</span>)</span><br><span class="line">        .replace(<span class="regexp">/&#123;#(.+?)#&#125;/g</span>, (match, p) =&gt; <span class="string">`'; <span class="subst">$&#123;p&#125;</span>; tpl += '`</span>)</span><br><span class="line">    <span class="comment">// console.log(tplStr)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'data'</span>, <span class="string">`var tpl='<span class="subst">$&#123;tplStr&#125;</span>'; return tpl;`</span>)(data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">const</span> str = <span class="string">`</span></span><br><span class="line"><span class="string">    &#123;# if( data.con &gt; 20 ) &#123; #&#125;</span></span><br><span class="line"><span class="string">        &lt;p&gt;ifififififif&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &#123;# &#125; else &#123; #&#125;</span></span><br><span class="line"><span class="string">        &lt;p&gt;elseelseelseelse&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &#123;# &#125; #&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#123;# for(var i = 0; i &lt; data.list.length; i++) &#123; #&#125;</span></span><br><span class="line"><span class="string">    &lt;p&gt;&#123;&#123;i &#125;&#125; : &#123;&#123; data.list[i] &#125;&#125;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &#123;# &#125; #&#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"><span class="keyword">const</span> data = &#123;<span class="attr">con</span>:<span class="number">21</span>, <span class="attr">list</span>: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">76</span>,<span class="number">87</span>,<span class="number">8</span>]&#125;</span><br><span class="line"><span class="built_in">console</span>.log( tpl(str, data) )</span><br><span class="line"><span class="comment">// &lt;p&gt;ifififififif&lt;/p&gt;</span></span><br><span class="line"><span class="comment">// &lt;p&gt;0 : 1&lt;/p&gt;&lt;p&gt;1 : 2&lt;/p&gt;&lt;p&gt;2 : 3&lt;/p&gt;&lt;p&gt;3 : 4&lt;/p&gt;&lt;p&gt;4 : 5....后边略</span></span><br></pre></td></tr></table></figure><p>ok, 一个最最简单的模板引擎就已经完成了，支持在模板中嵌入 js 语句，虽然只有不到10行，但还是挺强大的对不?</p><p><strong>资料</strong><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function" target="_blank" rel="noopener">Function语法</a></p><h4 id="拓展-分步实现模板引擎"><a href="#拓展-分步实现模板引擎" class="headerlink" title="拓展:分步实现模板引擎"></a><strong>拓展</strong>:分步实现模板引擎</h4><p>第一步：为了能够更好的使用，将前面的代码抽成一个类。</p><ul><li>标识符格式有可能和后端模板引擎冲突，因此应实现成可配置的</li><li>在模板中应能添加注释</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tpl</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (config) &#123;</span><br><span class="line">        <span class="keyword">const</span> defaultConfig = &#123;</span><br><span class="line">            signs: &#123;</span><br><span class="line">                varSign:       [<span class="string">'&#123;&#123;'</span>, <span class="string">'&#125;&#125;'</span>],    <span class="comment">// 变量/表达式</span></span><br><span class="line">            evalSign:      [<span class="string">'&#123;#'</span>, <span class="string">'#&#125;'</span>],    <span class="comment">// 语句</span></span><br><span class="line">                commentSign:   [<span class="string">'&lt;!--'</span>, <span class="string">'--&gt;'</span>], <span class="comment">// 普通注释</span></span><br><span class="line">                noCommentSign: [<span class="string">'&#123;@'</span>, <span class="string">'@&#125;'</span>]     <span class="comment">// 忽略注释</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 可通过配置来修改标识符</span></span><br><span class="line">        <span class="keyword">this</span>.config = <span class="built_in">Object</span>.assign(&#123;&#125;, defaultConfig, config)</span><br><span class="line">        <span class="comment">// ['&#123;&#123;', '&#125;&#125;'] =&gt; /&#123;&#123;([\\s\\S]+?)&#125;&#125;/g 构造正则</span></span><br><span class="line">        <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.config.signs).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.config.signs[key].splice(<span class="number">1</span>, <span class="number">0</span>, <span class="string">'(.+?)'</span>)</span><br><span class="line">            <span class="keyword">this</span>.config.signs[key] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="keyword">this</span>.config.signs[key].join(<span class="string">''</span>), <span class="string">'g'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 模板解析</span></span><br><span class="line">    _compile (str, data)&#123;</span><br><span class="line"><span class="keyword">const</span> tpl = str.replace(<span class="regexp">/\n/g</span>, <span class="string">''</span>)</span><br><span class="line">            <span class="comment">// 注释</span></span><br><span class="line">    .replace( <span class="keyword">this</span>.config.signs.noCommentSign, () =&gt; <span class="string">''</span>)</span><br><span class="line">    .replace( <span class="keyword">this</span>.config.signs.commentSign,</span><br><span class="line">     (match, p) =&gt; <span class="string">`'+'&lt;!-- <span class="subst">$&#123;p&#125;</span> --&gt;'+'`</span>)</span><br><span class="line">            <span class="comment">// 表达式/变量</span></span><br><span class="line">    .replace( <span class="keyword">this</span>.config.signs.varSign, (match, p) =&gt; <span class="string">`'+(<span class="subst">$&#123;p&#125;</span>)+'`</span>)</span><br><span class="line">            <span class="comment">// 语句</span></span><br><span class="line">    .replace( <span class="keyword">this</span>.config.signs.evalSign, (match, p) =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span>  exp = p.replace(<span class="string">'&amp;gt;'</span>, <span class="string">'&gt;'</span>).replace(<span class="string">'&amp;lt;'</span>, <span class="string">'&lt;'</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`'; <span class="subst">$&#123;exp&#125;</span>; tpl += '`</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'data'</span>, <span class="string">`var tpl='<span class="subst">$&#123;tpl&#125;</span>'; return tpl;`</span>)(data)</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// 入口</span></span><br><span class="line">    compile (tplStr, data) &#123; <span class="keyword">return</span> <span class="keyword">this</span>._compile(tplStr, data) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tpl</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Tpl(config)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log( tpl().compile(str, data) )</span><br></pre></td></tr></table></figure><p>第二步：解决注释的bug</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- &#123;&#123;a&#125;&#125; --&gt;</span><br><span class="line"><span class="comment">// 由于注释中有标识符，因此会将 a 作为变量解析，会报未定义错误</span></span><br></pre></td></tr></table></figure><ul><li>解决办法：在解析注释时，如注释里有标识符，则将其先替换成其他符号，等语句变量的解析完成时，再替换回来</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.replace( <span class="keyword">this</span>.config.signs.commentSign, (match, p) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> exp = p.replace(<span class="regexp">/[\&#123;\&lt;\&#125;\&gt;]/g</span>, match =&gt; <span class="string">`&amp;*&amp;<span class="subst">$&#123;match.charCodeAt()&#125;</span>&amp;*&amp;`</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`'+'&lt;!-- <span class="subst">$&#123;exp&#125;</span> --&gt;'+'`</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ... 解析变量和语句</span></span><br><span class="line">.replace(<span class="regexp">/\&amp;\*\&amp;(.*?)\&amp;\*\&amp;/g</span>, (match, p) =&gt;  <span class="built_in">String</span>.fromCharCode(p))</span><br></pre></td></tr></table></figure><p>第三步：增强语法支持<br>书写模板时，很多时候js语法需要用到’{‘或者’}’的时候，模板本身也有这个符号，顿时’{‘乱飞的情况就出现了。有些模板就提供了更好的语法：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;@ <span class="keyword">if</span> data.con &gt; <span class="number">20</span> @&#125; <span class="comment">// if (data.con &gt; 20) &#123;</span></span><br><span class="line">    &lt;p&gt;ifififififif&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&#123;@ elif data.con === 20 @&#125; /</span><span class="regexp">/ &#125; else if (data.con === 20) &#123;</span></span><br><span class="line"><span class="regexp">    &lt;p&gt;elseelseelseelseifififififif&lt;/</span>p&gt;</span><br><span class="line">&#123;@ <span class="keyword">else</span> @&#125; <span class="comment">// &#125; else &#123;</span></span><br><span class="line">    &lt;p&gt;elseelseelseelse&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&#123;/</span>@ <span class="keyword">if</span> @&#125; <span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// for (var index = 0; index &lt; data.list.length; index++) &#123; var item = data.list[index]</span></span><br><span class="line">&#123;@ each data.list <span class="keyword">as</span> item @&#125;</span><br><span class="line">    &lt;p&gt;循环 &#123;&#123; index + <span class="number">1</span> &#125;&#125; 次: &#123;&#123; item &#125;&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">&#123;/</span>@ each @&#125;</span><br></pre></td></tr></table></figure><p>其实就是在解析的语句时多了些处理，我们来把它加上：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置中增加 syntax 属性，默认 false, 其为 true 是开启 语法模式</span></span><br><span class="line"><span class="comment">// 配置中增加语法模式结束语句的标识符: endEvalSign: ['&#123;/#', '#&#125;']</span></span><br><span class="line"><span class="comment">// 给 Tpl 类添加方法，用于 语法模式 的语句解析</span></span><br><span class="line">_syntax (str)&#123;</span><br><span class="line">    <span class="keyword">const</span> arr = str.trim().split(<span class="regexp">/\s+/</span>)</span><br><span class="line">    <span class="keyword">let</span> exp = str</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (arr[<span class="number">0</span>] === <span class="string">'if'</span>) &#123;</span><br><span class="line">        <span class="comment">// if (xx) &#123;</span></span><br><span class="line">        exp = <span class="string">`if ( <span class="subst">$&#123;arr.slice(<span class="number">1</span>).join(<span class="string">' '</span>)&#125;</span> ) &#123;`</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[<span class="number">0</span>] === <span class="string">'else'</span>) &#123;</span><br><span class="line">        <span class="comment">// &#125; else &#123;</span></span><br><span class="line">        exp = <span class="string">'&#125; else &#123;'</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[<span class="number">0</span>] === <span class="string">'elif'</span>) &#123;</span><br><span class="line">        <span class="comment">// &#125; else if (xx) &#123;</span></span><br><span class="line">        exp = <span class="string">`&#125; else if ( <span class="subst">$&#123;arr.slice(<span class="number">1</span>).join(<span class="string">' '</span>)&#125;</span> ) &#123;`</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[<span class="number">0</span>] === <span class="string">'each'</span>) &#123;</span><br><span class="line">        <span class="comment">// for (var index = 0, len = xx.length; index &lt; len; index++) </span></span><br><span class="line">        <span class="comment">// &#123; var item = xx[index]</span></span><br><span class="line">        exp = <span class="string">`for (var index = 0, len = <span class="subst">$&#123;arr[<span class="number">1</span>]&#125;</span>.length; index &lt; len; index++) &#123;</span></span><br><span class="line"><span class="string">        var item = <span class="subst">$&#123;arr[<span class="number">1</span>]&#125;</span>[index]`</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> exp</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 修改 _compile 解析语句的 replace</span></span><br><span class="line">.replace( <span class="keyword">this</span>.config.signs.evalSign, (match, p) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span>  exp = p.replace(<span class="string">'&amp;gt;'</span>, <span class="string">'&gt;'</span>).replace(<span class="string">'&amp;lt;'</span>, <span class="string">'&lt;'</span>)</span><br><span class="line">                               <span class="comment">// 语法模式</span></span><br><span class="line">    exp = <span class="keyword">this</span>.config.syntax ? <span class="keyword">this</span>._syntax(exp) : exp</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`'; <span class="subst">$&#123;exp&#125;</span>; tpl += '`</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 增加结束标识的解析 &#123;/# if #&#125;  &#123;/# each #&#125;</span></span><br><span class="line">.replace( <span class="keyword">this</span>.config.signs.endEvalSign, () =&gt; <span class="string">"'&#125; tpl += '"</span>)</span><br></pre></td></tr></table></figure></p><p>第四步：增加过滤器支持<br>很多模板引擎中都有提供很多好用的过滤器:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 字符串转大写的过滤器</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; 'tpl' | upper &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span> =&gt; <span class="tag">&lt;<span class="name">p</span>&gt;</span>TPL<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">// 支持流式</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123; 'tpl' | f1 | f2 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>现在我们也来支持一下过滤：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 由于过滤器是对于变量的操作，所以只需在解析变量标识符&#123;&#123;&#125;&#125;的过程中做一下处理即可</span></span><br><span class="line"><span class="comment">// &#123;&#123;&#125;&#125; =&gt; 无过滤器直接返回， &#123;&#123; xx | xx &#125;&#125; 有过滤器则调用 Filters 类中对应的过滤器函数</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 过滤器函数</span></span><br><span class="line"><span class="keyword">const</span> Filters = &#123;</span><br><span class="line">    upper: <span class="function"><span class="params">str</span> =&gt;</span> str.toUpperCase()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析 &#123;&#123;&#125;&#125;</span></span><br><span class="line">.replace( <span class="keyword">this</span>.config.signs.varSign, (match, p) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> filterIndex = p.indexOf(<span class="string">'|'</span>)</span><br><span class="line">    <span class="keyword">let</span> val = p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (filterIndex !== <span class="number">-1</span>) &#123; <span class="comment">// 有过滤器</span></span><br><span class="line">        <span class="keyword">const</span></span><br><span class="line">            arr = val.split(<span class="string">'|'</span>).map(<span class="function"><span class="params">s</span> =&gt;</span> s.trim()),</span><br><span class="line">            filters = arr.slice(<span class="number">1</span>) || [],</span><br><span class="line">            oldVal  = arr[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        val = filters.reduce(<span class="function">(<span class="params">curVal, filterName</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ( ! Filters[filterName] ) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`没有 <span class="subst">$&#123;filterName&#125;</span> 过滤器`</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`Filters['<span class="subst">$&#123;filterName&#125;</span>'](<span class="subst">$&#123;curVal&#125;</span>)`</span></span><br><span class="line">        &#125;, oldVal)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">`'+(<span class="subst">$&#123;val&#125;</span>)+'`</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用</span></span><br><span class="line"><span class="comment">// &lt;h1&gt;&#123;&#123; 'tpl' | upper | reverse &#125;&#125;&lt;/h1&gt; // =&gt; 'LPT'</span></span><br></pre></td></tr></table></figure></p><p>至此，我们的模板引擎就初步完成了，总结下功能:</p><ul><li>支持在模板中使用 js 语句</li><li>支持自定义标识符</li><li>支持更简洁的语法模式</li><li>支持过滤器</li></ul><p>以上代码总结一下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Filters = &#123;</span><br><span class="line">    upper: <span class="function"><span class="params">str</span> =&gt;</span> str.toUpperCase(),</span><br><span class="line">    lower: <span class="function"><span class="params">str</span> =&gt;</span> str.toLowerCase(),</span><br><span class="line">    reverse: <span class="function"><span class="params">str</span> =&gt;</span> str.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>),</span><br><span class="line">    <span class="built_in">escape</span>: <span class="function"><span class="params">str</span> =&gt;</span> str.replace(<span class="regexp">/&amp;(?!\w+;)/g</span>, <span class="string">'&amp;amp;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&lt;/g</span>, <span class="string">'&amp;lt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/&gt;/g</span>, <span class="string">'&amp;gt;'</span>)</span><br><span class="line">            .replace(<span class="regexp">/"/g</span>, <span class="string">'&amp;quot;'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tpl</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> (config=&#123;&#125;) &#123;</span><br><span class="line">        <span class="keyword">const</span> defaultConfig = &#123;</span><br><span class="line">            signs: &#123;</span><br><span class="line">                varSign:       [<span class="string">'&#123;&#123;'</span>, <span class="string">'&#125;&#125;'</span>],    <span class="comment">// 变量/表达式/过滤器</span></span><br><span class="line">            evalSign:      [<span class="string">'&#123;#'</span>, <span class="string">'#&#125;'</span>],    <span class="comment">// 语句</span></span><br><span class="line">                endEvalSign:   [<span class="string">'&#123;/#'</span>, <span class="string">'#&#125;'</span>],   <span class="comment">// 语法模式结束语句</span></span><br><span class="line">                commentSign:   [<span class="string">'&lt;!--'</span>, <span class="string">'--&gt;'</span>], <span class="comment">// 普通注释</span></span><br><span class="line">                noCommentSign: [<span class="string">'&#123;@'</span>, <span class="string">'@&#125;'</span>]     <span class="comment">// 忽略注释</span></span><br><span class="line">            &#125;,</span><br><span class="line">            syntax: <span class="literal">false</span>                       <span class="comment">// 语法模式</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.config = <span class="built_in">Object</span>.assign(&#123;&#125;, defaultConfig, config)</span><br><span class="line">        <span class="comment">// ['&#123;&#123;', '&#125;&#125;'] =&gt; /&#123;&#123;([\\s\\S]+?)&#125;&#125;/g 构造正则</span></span><br><span class="line">        <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.config.signs).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.config.signs[key].splice(<span class="number">1</span>, <span class="number">0</span>, <span class="string">'(.+?)'</span>)</span><br><span class="line">            <span class="keyword">this</span>.config.signs[key] = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="keyword">this</span>.config.signs[key].join(<span class="string">''</span>), <span class="string">'g'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 语法模式</span></span><br><span class="line">    _syntax (str) &#123;</span><br><span class="line">        <span class="keyword">const</span> arr = str.trim().split(<span class="regexp">/\s+/</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'1111:  '</span>+arr)</span><br><span class="line">        <span class="keyword">let</span> exp = str</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (arr[<span class="number">0</span>] === <span class="string">'if'</span>) &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'2222:  '</span>+arr.slice(<span class="number">1</span>).join(<span class="string">' '</span>))</span><br><span class="line">            <span class="comment">// if (xx) &#123;</span></span><br><span class="line">            exp = <span class="string">`if ( <span class="subst">$&#123;arr.slice(<span class="number">1</span>).join(<span class="string">' '</span>)&#125;</span> ) &#123;`</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[<span class="number">0</span>] === <span class="string">'else'</span>) &#123;</span><br><span class="line">            <span class="comment">// &#125; else &#123;</span></span><br><span class="line">            exp = <span class="string">'&#125; else &#123;'</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[<span class="number">0</span>] === <span class="string">'elif'</span>) &#123;</span><br><span class="line">            <span class="comment">// &#125; else if (xx) &#123;</span></span><br><span class="line">            exp = <span class="string">`&#125; else if ( <span class="subst">$&#123;arr.slice(<span class="number">1</span>).join(<span class="string">' '</span>)&#125;</span> ) &#123;`</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[<span class="number">0</span>] === <span class="string">'each'</span>) &#123;</span><br><span class="line">            <span class="comment">// for (var index = 0, len = xx.length; index &lt; len; index++) &#123;</span></span><br><span class="line">            exp = <span class="string">`for (var index = 0, len = <span class="subst">$&#123;arr[<span class="number">1</span>]&#125;</span>.length; index &lt; len; index++)</span></span><br><span class="line"><span class="string">&#123;var item = <span class="subst">$&#123;arr[<span class="number">1</span>]&#125;</span>[index]`</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> exp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 模板解析</span></span><br><span class="line">    _compile (str, data)&#123;</span><br><span class="line"><span class="keyword">const</span> tpl = str.replace(<span class="regexp">/\n/g</span>, <span class="string">''</span>)</span><br><span class="line">            <span class="comment">// 注释</span></span><br><span class="line">    .replace( <span class="keyword">this</span>.config.signs.noCommentSign, () =&gt; <span class="string">''</span>)</span><br><span class="line">    .replace( <span class="keyword">this</span>.config.signs.commentSign, (match, p) =&gt; &#123;</span><br><span class="line">                <span class="keyword">const</span> exp = p.replace(<span class="regexp">/[\&#123;\&lt;\&#125;\&gt;]/g</span>, </span><br><span class="line">                match =&gt; <span class="string">`&amp;*&amp;<span class="subst">$&#123;match.charCodeAt()&#125;</span>&amp;*&amp;`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`'+'&lt;!-- <span class="subst">$&#123;exp&#125;</span> --&gt;'+'`</span></span><br><span class="line">    &#125;)</span><br><span class="line">            <span class="comment">// 变量/表达式</span></span><br><span class="line">    .replace( <span class="keyword">this</span>.config.signs.varSign, (match, p) =&gt; &#123;</span><br><span class="line">                <span class="keyword">const</span> filterIndex = p.indexOf(<span class="string">'|'</span>)</span><br><span class="line">                <span class="keyword">let</span> val = p</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (filterIndex !== <span class="number">-1</span>) &#123; <span class="comment">// 有过滤器</span></span><br><span class="line">                    <span class="keyword">const</span></span><br><span class="line">                        arr = val.split(<span class="string">'|'</span>).map(<span class="function"><span class="params">s</span> =&gt;</span> s.trim()),</span><br><span class="line">                        filters = arr.slice(<span class="number">1</span>) || [],</span><br><span class="line">                        oldVal  = arr[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">                    val = filters.reduce(<span class="function">(<span class="params">curVal, filterName</span>) =&gt;</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> ( ! Filters[filterName] ) &#123;</span><br><span class="line">                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`没有 <span class="subst">$&#123;filterName&#125;</span> 过滤器`</span>)</span><br><span class="line">                            <span class="keyword">return</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="string">`Filters['<span class="subst">$&#123;filterName&#125;</span>'](<span class="subst">$&#123;curVal&#125;</span>)`</span></span><br><span class="line">                    &#125;, oldVal)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">console</span>.log(val)</span><br><span class="line">                <span class="keyword">return</span> <span class="string">`'+(<span class="subst">$&#123;val&#125;</span>)+'`</span></span><br><span class="line">            &#125;)</span><br><span class="line">            <span class="comment">// 语句</span></span><br><span class="line">    .replace( <span class="keyword">this</span>.config.signs.evalSign, (match, p) =&gt; &#123;</span><br><span class="line">                <span class="keyword">let</span>  exp = p.replace(<span class="string">'&amp;gt;'</span>, <span class="string">'&gt;'</span>).replace(<span class="string">'&amp;lt;'</span>, <span class="string">'&lt;'</span>)</span><br><span class="line">                                           <span class="comment">// 语法模式</span></span><br><span class="line">                exp = <span class="keyword">this</span>.config.syntax ? <span class="keyword">this</span>._syntax(exp) : exp</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`'; <span class="subst">$&#123;exp&#125;</span>; tpl += '`</span></span><br><span class="line">    &#125;)</span><br><span class="line">            <span class="comment">// 语法模式(结束标签)</span></span><br><span class="line">            .replace( <span class="keyword">this</span>.config.signs.endEvalSign, () =&gt; <span class="string">"'&#125; tpl += '"</span>)</span><br><span class="line">            .replace(<span class="regexp">/\&amp;\*\&amp;(.*?)\&amp;\*\&amp;/g</span>, (match, p) =&gt;  <span class="built_in">String</span>.fromCharCode(p))</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">'data'</span>, <span class="string">`var tpl='<span class="subst">$&#123;tpl&#125;</span>'; return tpl;`</span>)(data)</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// 入口</span></span><br><span class="line">    compile (tplStr, data) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>._compile(tplStr, data)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            <span class="built_in">console</span>.warn(err)</span><br><span class="line">            <span class="built_in">console</span>.trace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tpl</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Tpl(config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>跑代码测试一下吧！！</p><p></p><p data-height="265" data-theme-id="0" data-slug-hash="VyjNNq" data-default-tab="html,result" data-user="jinwang" data-embed-version="2" data-pen-title="VyjNNq" class="codepen">See the Pen <a href="https://codepen.io/jinwang/pen/VyjNNq/" target="_blank" rel="noopener">VyjNNq</a> by  石其龙 (<a href="https://codepen.io/jinwang" target="_blank" rel="noopener">@jinwang</a>) on <a href="https://codepen.io" target="_blank" rel="noopener">CodePen</a>.</p><p></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;   前端模板引擎相信大家都不会陌生了吧，尤其是注重前后端分离的今天(除非你还在用拼接字符串)。&lt;br&gt;   &lt;strong&gt;引擎&lt;/strong&gt;一词总让人感觉很高端的样子，其实归根结底也只是处理字符串的一种方式而已。&lt;br&gt;   本文总结了3种实现模板引擎的方式，最后将逐步实现一个类似于 underscore.template 的模板插件。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="web前端" scheme="https://es-7.github.io/categories/web%E5%89%8D%E7%AB%AF/"/>
    
      <category term="基础" scheme="https://es-7.github.io/categories/web%E5%89%8D%E7%AB%AF/%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="模板引擎" scheme="https://es-7.github.io/tags/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E/"/>
    
  </entry>
  
  <entry>
    <title>js原生继承</title>
    <link href="https://es-7.github.io/2015/07/03/inheirt/"/>
    <id>https://es-7.github.io/2015/07/03/inheirt/</id>
    <published>2015-07-02T16:00:00.000Z</published>
    <updated>2017-12-23T10:55:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>  js中的继承有多种实现方式，今天我们来分析一下各种继承的方式以及其优缺点。<br> <a id="more"></a>   </p><h3 id="原型链继承"><a href="#原型链继承" class="headerlink" title="原型链继承"></a>原型链继承</h3><p>   首先介绍一下原型链的基本概念。<br>   先来理解一下原型、构造函数和实例之间的关系。      </p><ul><li>每个构造函数都有一个原型对象（通过prototype属性）    </li><li>原型对象都包含一个指向构造函数的指针（通过constructor属性）</li><li>实例都包含一个指向原型对象的内部指针（通过隐式__proto__属性）</li></ul><p>   那么，若原型对象被另一个原型的实例覆盖，则此时原型对象将包含一个指向另一个原型对象的指针。按照这样层层递进，就构成了实例与原型的链条。</p><p>   这个概念可能不好理解，请看下面例子：<br> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 父类</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'parent name is '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子类</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用原型链继承Parent构造函数</span></span><br><span class="line">Child.prototype = <span class="keyword">new</span> Parent(<span class="string">'father'</span>);</span><br><span class="line"><span class="comment">// constructor属性，指向当前的Child构造函数。</span></span><br><span class="line">Child.prototype.constructor = Child;</span><br><span class="line">Child.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'child name is '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 调用父类</span></span><br><span class="line"><span class="keyword">var</span> parent = <span class="keyword">new</span> Parent(<span class="string">'father'</span>);</span><br><span class="line">parent.sayName(); <span class="comment">// parent name is father!</span></span><br><span class="line"><span class="comment">// 调用子类</span></span><br><span class="line"><span class="keyword">var</span> child = <span class="keyword">new</span> Child(<span class="string">'son'</span>);</span><br><span class="line">child.sayName(); <span class="comment">// child name is son!</span></span><br><span class="line">child.age = <span class="number">18</span>;</span><br><span class="line"><span class="built_in">console</span>.log(child.age); <span class="comment">// 18</span></span><br></pre></td></tr></table></figure></p><p>  例子中通过将Child的原型对象覆盖，将Child与Parent关联起来了。</p><p>  使用原型链继承缺点：</p><ul><li>由于包含引用类型值的原型属性会被所有实例共享，导致修改一个实例引用值，所有的实例对于这个引用全部被修改。请看下面例子：</li></ul>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.colors = [<span class="string">"red"</span>,<span class="string">"blue"</span>,<span class="string">"green"</span>];</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">"super"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = <span class="keyword">new</span> Parent();</span><br><span class="line"><span class="keyword">var</span> instance1 = <span class="keyword">new</span> Child();</span><br><span class="line">instance1.colors.push(<span class="string">"black"</span>);</span><br><span class="line">instance1.name = <span class="string">"sub"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(instance1.name); <span class="comment">// sub</span></span><br><span class="line"><span class="built_in">console</span>.log(instance1.colors); <span class="comment">//red, blue, green, black</span></span><br><span class="line"><span class="keyword">var</span> instance2 = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="built_in">console</span>.log(instance2.name); <span class="comment">// super</span></span><br><span class="line"><span class="built_in">console</span>.log(instance2.colors); <span class="comment">//red, blue, green, black</span></span><br></pre></td></tr></table></figure><p>  就像上面的例子所示，当我们new一个新对象时（其过程可查看new一个新对象会发生什么），原型属性会复制一份到我们实例中。对于值类型，实例会复制其名字和值放在另一块内存中；而对于引用类型，实例只是复制了指向它的值的指针。因而修改实例的值类型，不会影响其他实例；但是修改引用类型的值，其他实例也会被影响到。</p><ul><li><p>创建子类型的实例时，并不能在不影响所有对象实例的情况下给超类型的构造函数传递参数。 </p></li><li><p>顺序不当可能会引发问题，如Child.prototype.sayName 必须写在 Child.prototype = new Parent(‘father’); 之后，不然就会被覆盖掉。</p></li></ul><h3 id="构造函数继承"><a href="#构造函数继承" class="headerlink" title="构造函数继承"></a>构造函数继承</h3><p>  基本思想：在子类型构造函数内部调用超类型构造函数。<br>  还是先看例子：<br>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 父类</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'parent name is '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Parent.prototype.doSomthing = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'parent do something!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子类</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 通过call,apply 改变对象的this指向来继承</span></span><br><span class="line">    Parent.call(<span class="keyword">this</span>, name);</span><br><span class="line">    <span class="comment">// Parent.apply(this, arguments);</span></span><br><span class="line">&#125;</span><br><span class="line">Child.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'child name is '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> child = <span class="keyword">new</span> Child(<span class="string">'son'</span>);</span><br><span class="line">child.sayName(); <span class="comment">// child name: son</span></span><br><span class="line">child.doSomthing(); <span class="comment">// TypeError: child.doSomthing is not a function</span></span><br></pre></td></tr></table></figure></p><p> 相当于 Parent 函数在 Child 函数中执行了一遍，并且将所有与 this 绑定的变量都切换到了 Child 上，使用构造函数继承的方式解决了原型链继承的问题：</p><ul><li>实例可以独享一份引用类型的值<br>通过call改变this指向，这样每次执行Parent函数，this指向的都是新的对象。相当于每个新的对象都有一份完整的Parent代码。即每个实例都有一份自己的属性副本。</li></ul><ul><li>可以传参数<br>我们可以通过call函数向Parent传参数   </li></ul><p>构造函数继承也有缺点：</p><ul><li>无法实现函数复用<br>看上面的代码可知，我们只是执行了Parent函数，但是并没有继承它的原型链上的函数。这样会导致若要使用公有函数时，自己定义或者在Parent构造函数中定义，违背了函数复用的初衷。</li></ul><h3 id="组合继承"><a href="#组合继承" class="headerlink" title="组合继承"></a>组合继承</h3><p>组合继承将原型链继承和构造函数继承结合到一起，是最常用的的继承方式。<br>基本思想是：使用原型链实现对原型属性和方法的继承，借用构造函数实现对实例属性的继承。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 父类</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'parent name is '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line">Parent.prototype.doSomthing = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'parent do something!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子类</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 通过call,apply 改变对象的this指向来继承</span></span><br><span class="line">    Parent.call(<span class="keyword">this</span>, name);  <span class="comment">// 第二次调用 </span></span><br><span class="line">    <span class="comment">// Parent.apply(this, arguments);</span></span><br><span class="line">&#125;</span><br><span class="line">Child.prototype = <span class="keyword">new</span> Parent(<span class="string">'father'</span>);  <span class="comment">// 第一次调用</span></span><br><span class="line">Child.prototype.constructor = Child;</span><br><span class="line">Child.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'child name is '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> child = <span class="keyword">new</span> Child(<span class="string">'son'</span>);</span><br><span class="line">child.sayName(); <span class="comment">// child name: son</span></span><br><span class="line">child.doSomthing(); <span class="comment">// parent do something!</span></span><br></pre></td></tr></table></figure></p><p>由例子可知，组合继承结合了原型链继承和构造函数继承的优点，既可以拥有属于自己的属性，也有了共同的方法。<br>当然，它也有缺点。</p><ul><li>无论什么情况下，都会调用两次超类型构造函数。一次在创建子类型的原型时；一次在子类型构造函数内部。当第二次调用时，会重写第一次调用时获得的原型属性。</li></ul><h3 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h3><p>基本思想：借助已有的对象创建新对象，不必通过构造函数。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ob = &#123; <span class="attr">name</span>: <span class="string">'李达康'</span>, <span class="attr">friends</span>: [<span class="string">'沙瑞金'</span>, <span class="string">'季昌明'</span>] &#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 原型式继承  参数o,引用类型值，实质就是一个内存地址</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; obj</span></span><br><span class="line"><span class="comment"> * @returns</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">object</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个构造函数F</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">F</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 空构造函数F</span></span><br><span class="line">    &#125;</span><br><span class="line">    F.prototype = obj;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> F();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ob1 = object(ob);</span><br><span class="line">ob1.name = <span class="string">'侯亮明'</span>;</span><br><span class="line">ob1.friends.push(<span class="string">'陈海'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(ob1.name); <span class="comment">// 侯亮明</span></span><br><span class="line"><span class="built_in">console</span>.log(ob1.friends); <span class="comment">// ["沙瑞金", "季昌明", "陈海"]</span></span><br><span class="line"><span class="keyword">var</span> ob2 = object(ob);</span><br><span class="line"><span class="built_in">console</span>.log(ob2.name); <span class="comment">// 李达康</span></span><br><span class="line"><span class="built_in">console</span>.log(ob2.friends); <span class="comment">// ["沙瑞金", "季昌明", "陈海"]</span></span><br></pre></td></tr></table></figure><p>可以看出该方法与原型链继承类似，但是写法比它简单。<br>因此，若只是想让一个对象和另一个相似，可以使用这种方法。<br>不过它也存在缺点：</p><ul><li>包含引用类型值的属性始终共享相应的值。</li></ul><h3 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h3><p>基本思想：创建一个仅用于封装继承过程的函数，在内部对对象做相关增强，然后返回。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ob = &#123; <span class="attr">name</span>: <span class="string">'李达康'</span>, <span class="attr">friends</span>: [<span class="string">'沙瑞金'</span>, <span class="string">'季昌明'</span>] &#125;;</span><br><span class="line"><span class="comment">// 上面再ECMAScript5 有了一新的规范写法，Object.create(ob) 效果是一样的</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个对象</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; o</span></span><br><span class="line"><span class="comment"> * @returns</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createOb</span>(<span class="params">o</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newob = <span class="built_in">Object</span>.create(o); <span class="comment">// 创建对象</span></span><br><span class="line">    newob.sayname = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 增强对象</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> newob; <span class="comment">// 指定对象</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> ob1 = createOb(ob);</span><br><span class="line">ob1.sayname(); <span class="comment">// 李达康</span></span><br></pre></td></tr></table></figure><p>这样做相当于构造函数那样，并不是真正的函数复用。而且包含引用类型值的属性依然始终共享相应的值。</p><h3 id="寄生组合式继承"><a href="#寄生组合式继承" class="headerlink" title="寄生组合式继承"></a>寄生组合式继承</h3><p>这个方法属于比较完美的方法。先看代码：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现继承</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; Parent 父类</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; Child  子类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inheritPrototype</span>(<span class="params">Parent, Child</span>) </span>&#123;</span><br><span class="line">    Child.prototype = <span class="built_in">Object</span>.create(Parent.prototype); <span class="comment">// 修改</span></span><br><span class="line">    Child.prototype.construtor = Child;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 父类</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.friends = [<span class="string">'达康'</span>, <span class="string">'瑞金'</span>];</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'parent name is '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子类</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment"> * @param &#123;any&#125; parentName</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">name, parentName</span>) </span>&#123;</span><br><span class="line">    Parent.call(<span class="keyword">this</span>, parentName);</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 实现继承</span></span><br><span class="line">inheritPrototype(Parent, Child);</span><br><span class="line">Child.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'child name is '</span> + <span class="keyword">this</span>.name + <span class="string">'!'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> parent = <span class="keyword">new</span> Parent(<span class="string">'father'</span>);</span><br><span class="line">parent.sayName(); <span class="comment">// parent name: father</span></span><br><span class="line"><span class="keyword">var</span> child1 = <span class="keyword">new</span> Child(<span class="string">'son'</span>, <span class="string">'father'</span>);</span><br><span class="line">child1.friends.push(<span class="string">'猴子'</span>); <span class="comment">// ["达康", "瑞金", "猴子"]</span></span><br><span class="line"><span class="built_in">console</span>.log(child1.friends);</span><br><span class="line">child1.sayName(); <span class="comment">// child name: son</span></span><br><span class="line"><span class="keyword">var</span> child2 = <span class="keyword">new</span> Child(<span class="string">'son2'</span>, <span class="string">'father'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(child2.friends); <span class="comment">// ["达康", "瑞金"]</span></span><br><span class="line">child1.sayName(); <span class="comment">// child name: son2</span></span><br></pre></td></tr></table></figure><p>这个方法解决了组合继承调用两次超类型的缺点。</p><p>首先回顾一下组合继承的两次调用：</p><ul><li><p>创建子类型的原型对象时调用（new Parent()）<br>这个过程会主要是new一个对象的过程，它会复制Parent的属性和方法给子类型。</p></li><li><p>在子类型构造函数里调用<br>在构造函数里调用时，又会复制一遍超类型的属性，因而会影响性能。</p></li></ul><p>对于寄生组合式继承方式：</p><ul><li>先将超类型中的原型对象复制一份，再new对象作为子类型的原型对象。这样做，我们只是复制了超类型的原型对象，而对于超类型构造函数里的属性不会复制。因而减少了调用超类型的次数。</li><li>这样做仍然保持原型链不变</li></ul><h3 id="ES6中class实现继承"><a href="#ES6中class实现继承" class="headerlink" title="ES6中class实现继承"></a>ES6中class实现继承</h3><ul><li><p>ES6提供了更接近传统语言”类”的写法，引入了Class（类）这个概念，作为对象的模板。通过class关键字，可以定义类。</p></li><li><p>基本上，ES6的class可以看作只是一个语法糖，它的绝大部分功能，ES5都可以做到；新的class写法只是让对象原型的写法更加清晰、更像面向对象编程的语法而已。</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 父类</span></span><br><span class="line"><span class="comment"> * @class Parent</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates an instance of Parent.</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment">     * @memberOf Parent</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 做点东西</span></span><br><span class="line"><span class="comment">     * @memberOf Parent</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    doSomething() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'parent do something!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印名字</span></span><br><span class="line"><span class="comment">     * @memberOf Parent</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    sayName() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`parent name is <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>!`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 子类 继承 父类</span></span><br><span class="line"><span class="comment"> * @class Child</span></span><br><span class="line"><span class="comment"> * @extends &#123;Parent&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Creates an instance of Child.</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; name</span></span><br><span class="line"><span class="comment">     * @param &#123;any&#125; parentName</span></span><br><span class="line"><span class="comment">     * @memberOf Child</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">constructor</span>(name, parentName) &#123;</span><br><span class="line">        <span class="comment">// 调用基类的构造方法</span></span><br><span class="line">        <span class="keyword">super</span>(parentName);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 打印名字 覆盖父类的sayName方法</span></span><br><span class="line"><span class="comment">     * @memberOf Child</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    sayName() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`child name is <span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>!`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> child = <span class="keyword">new</span> Child(<span class="string">'son'</span>, <span class="string">'father'</span>);</span><br><span class="line">child.sayName(); <span class="comment">// child name: son</span></span><br><span class="line">child.doSomething(); <span class="comment">// parent do something!</span></span><br><span class="line"><span class="keyword">const</span> parent = <span class="keyword">new</span> Parent(<span class="string">'father'</span>);</span><br><span class="line">parent.sayName(); <span class="comment">// parent name: father</span></span><br></pre></td></tr></table></figure><p>如果项目中使用到ES6语法开发，推荐使用ES6继承</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;  js中的继承有多种实现方式，今天我们来分析一下各种继承的方式以及其优缺点。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="web前端" scheme="https://es-7.github.io/categories/web%E5%89%8D%E7%AB%AF/"/>
    
      <category term="基础" scheme="https://es-7.github.io/categories/web%E5%89%8D%E7%AB%AF/%E5%9F%BA%E7%A1%80/"/>
    
    
      <category term="继承" scheme="https://es-7.github.io/tags/%E7%BB%A7%E6%89%BF/"/>
    
  </entry>
  
</feed>
